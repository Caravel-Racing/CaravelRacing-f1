
<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Caravel Racing — Website</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<script>
(function () {
  // Espera pelo DOM estar pronto
  document.addEventListener('DOMContentLoaded', () => {

    // --- Helpers para criar o splash caso não exista ---
    function createSplashMarkup() {
      const splash = document.createElement('div');
      splash.id = 'splash';
      splash.className = 'splash-overlay';
      splash.setAttribute('aria-hidden', 'false');
      splash.innerHTML = `
        <div class="splash-inner">
          <h1 class="splash-title">Caravel Racing</h1>
          <div class="splash-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="splash-fill" style="width:0%"></div>
          </div>
          <div class="splash-percent"><span id="splash-num">0</span>%</div>
        </div>
      `;
      document.body.appendChild(splash);
      return splash;
    }

    // Obtém o elemento splash existente ou cria um novo
    let splash = document.getElementById('splash');
    if (!splash) {
      splash = createSplashMarkup();
    }

    // Seleciona fill e número — se não existirem, cria-os dentro do splash
    let fill = splash.querySelector('.splash-fill');
    let num = splash.querySelector('#splash-num');

    if (!fill || !num) {
      // rebuild inner content (defensivo)
      splash.innerHTML = `
        <div class="splash-inner">
          <h1 class="splash-title">Caravel Racing</h1>
          <div class="splash-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="splash-fill" style="width:0%"></div>
          </div>
          <div class="splash-percent"><span id="splash-num">0</span>%</div>
        </div>
      `;
      fill = splash.querySelector('.splash-fill');
      num = splash.querySelector('#splash-num');
    }

    // Segurança: se ainda não encontrou, aborta (mas sem lançar erro)
    if (!fill || !num) {
      console.warn('Splash: elementos .splash-fill ou #splash-num não encontrados — loader desativado para evitar bloqueio.');
      // remove splash para não bloquear a interface
      splash.classList.add('hidden');
      setTimeout(() => { if (splash.parentNode) splash.parentNode.removeChild(splash); }, 500);
      return;
    }

    // Impede scroll enquanto o splash está ativo
    document.documentElement.classList.add('splash-active');
    document.body.classList.add('splash-active');

    // Lógica de progress simulada
    let progress = 0;
    let running = true;
    fill.style.width = '0%';
    num.textContent = '0';

    const stepInterval = 40; // ms entre passos
    const intervalId = setInterval(() => {
      if (!running) return;

      // incremento adaptativo: rápido no início, mais lento perto do fim
      if (progress < 70) {
        progress += Math.ceil(Math.random() * 4); // 1-4
      } else if (progress < 90) {
        progress += Math.ceil(Math.random() * 2); // 1-2
      } else if (progress < 97) {
        progress += 1; // lento
      } // não passa de 99 aqui; só o load coloca 100

      if (progress > 99) progress = 99;
      fill.style.width = progress + '%';
      num.textContent = String(progress);
    }, stepInterval);

    // Função para fechar o splash (fade + remover)
    function closeSplash() {
      if (!splash) return;
      running = false;
      clearInterval(intervalId);
      fill.style.width = '100%';
      num.textContent = '100';

      // espera pequeno delay para mostrar 100%
      setTimeout(() => {
        splash.classList.add('hidden');
        // remove do DOM após a transição de opacidade terminar
        const removeAfter = () => {
          try {
            if (splash.parentNode) splash.parentNode.removeChild(splash);
          } catch (e) { /* ignore */ }
          document.documentElement.classList.remove('splash-active');
          document.body.classList.remove('splash-active');
        };
        // tenta ouvir transitionend, se não houver, remove após 600ms
        let handled = false;
        splash.addEventListener('transitionend', () => {
          if (handled) return;
          handled = true;
          removeAfter();
        }, { once: true });

        setTimeout(() => {
          if (!handled) removeAfter();
        }, 700);
      }, 220);
    }

    // Se a janela completar o load, vai para 100% e fecha
    window.addEventListener('load', () => {
      closeSplash();
    });

    // Força fechar caso algo trave: 8 segundos fallback
    setTimeout(() => {
      if (document.body.contains(splash)) {
        console.info('Splash: fallback a 100% após timeout');
        closeSplash();
      }
    }, 8000);

    // Pequeno fallback para quem quer testar em dev: se o utilizador clicar no overlay fecha
    splash.addEventListener('click', () => {
      console.info('Splash: fechado por clique do utilizador (debug).');
      closeSplash();
    });

  }); // DOMContentLoaded
})();
</script>

<body>
  <div id="splash" class="splash-overlay" aria-hidden="false">
    <div class="splash-inner">
      <h1 class="splash-title">Caravel Racing</h1>
      <div class="splash-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="splash-fill" style="width:0%"></div>
      </div>
      <div class="splash-percent"><span id="splash-num">0</span>%</div>
    </div>
  </div>


  <header class="site-header">
    <div class="container">
      <h1 class="brand"><span style="color: red; text-transform: uppercase;">CAR</span>AVEL Racing</h1>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="projects.html">Projetos</a>
        <a href="sobre-equipa.html">Sobre a Equipa</a>
        <a href="patrocinadores.html">Patrocinadores</a>
        <a href="contact.html">Contactos</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h2>Equipa portuguesa inscrita na competição 'STEM Racing'</h2>
      <p>ns • ns • ns • ns • ns</p>
      <p><a class="btn" href="projects.html">Ver Projetos</a></p>
    </section>

    <section class="kpis">
      <div class="card"><strong>Temporada</strong><p>2025/26</p></div>
      <div class="card"><strong>Média run</strong><p>— s</p></div>
      <div class="card"><strong>Membros</strong><p>6</p></div>
    </section>

    <section class="projects-preview">
      <div class="grid">
        <article class="project-card">
          <h4>Caravel V1 — 2025/26</h4>
          <p>Primeiro esboço</p>
          <p><a href="projects/caravel-v1-2025.html" class="btn small">Ver Projeto</a></p>
        </article>
      </div>
    </section>

  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© Caravel Racing — Portugal</p>
    </div>
  </footer>
</body>

</html>
